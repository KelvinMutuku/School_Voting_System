<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KITENGELA INTERNATIONAL SCHOOL JSS Algocracy ELECTIONS</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4">
    <header class="bg-blue-600 text-white p-4 rounded-lg shadow-md mb-6">
      <h1 class="text-3xl font-bold text-center uppercase">KITENGELA INTERNATIONAL SCHOOL JSS<br>ALGOCRACY ELECTIONS</h1>
      <nav class="mt-4">
        <ul class="flex justify-center space-x-4">
          <li><a href="#register" class="tab-link hover:underline" data-tab="register">Register</a></li>
          <li><a href="#about" class="tab-link hover:underline" data-tab="about">About</a></li>
          <li><a href="#vote" class="tab-link hover:underline" data-tab="vote">Vote</a></li>
          <li><a href="#results" class="tab-link hover:underline" data-tab="results">Results</a></li>
          <li><a href="#teacher" class="tab-link hover:underline" data-tab="teacher">Teacher</a></li>
          <li><a href="#admin" class="tab-link hover:underline" data-tab="admin">Admin</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="register" class="tab-content">
        <h2 class="text-2xl font-semibold mb-4">Student Registration</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <p class="mb-4">Enter your Student ID and a unique password to register.</p>
          <div class="mb-4">
            <label for="registerId" class="block text-gray-700 font-semibold">Student ID (KJS001–KJS057)</label>
            <input type="text" id="registerId" class="w-full p-2 border rounded" placeholder="e.g., KJS001" oninput="showStudentName()">
          </div>
          <div class="mb-4">
            <label for="registerName" class="block text-gray-700 font-semibold">Your Name</label>
            <input type="text" id="registerName" class="w-full p-2 border rounded" readonly>
          </div>
          <div class="mb-4">
            <label for="registerPassword" class="block text-gray-700 font-semibold">Password (min 6 characters)</label>
            <input type="password" id="registerPassword" class="w-full p-2 border rounded" placeholder="Enter your password">
          </div>
          <div class="mb-4">
            <label for="securityQuestion" class="block text-gray-700 font-semibold">Security Question</label>
            <select id="securityQuestion" class="w-full p-2 border rounded">
              <option value="">Select a security question</option>
              <option value="What is your mother's maiden name?">What is your mother's maiden name?</option>
              <option value="What is the name of your first pet?">What is the name of your first pet?</option>
              <option value="What city were you born in?">What city were you born in?</option>
            </select>
          </div>
          <div class="mb-4">
            <label for="securityAnswer" class="block text-gray-700 font-semibold">Security Answer</label>
            <input type="text" id="securityAnswer" class="w-full p-2 border rounded" placeholder="Enter your answer">
          </div>
          <button onclick="registerStudent()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Register</button>
          <p id="registerError" class="text-red-500 mt-2 hidden"></p>
          <p id="registerSuccess" class="text-green-500 mt-2 hidden">Registration successful!</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md mt-6">
          <h3 class="text-xl font-semibold mb-4">Change Password</h3>
          <div class="mb-4">
            <label for="changeId" class="block text-gray-700 font-semibold">Student ID</label>
            <input type="text" id="changeId" class="w-full p-2 border rounded" placeholder="e.g., KJS001">
          </div>
          <div class="mb-4">
            <label for="oldPassword" class="block text-gray-700 font-semibold">Old Password</label>
            <input type="password" id="oldPassword" class="w-full p-2 border rounded" placeholder="Enter old password">
          </div>
          <div class="mb-4">
            <label for="newPassword" class="block text-gray-700 font-semibold">New Password (min 6 characters)</label>
            <input type="password" id="newPassword" class="w-full p-2 border rounded" placeholder="Enter new password">
          </div>
          <button onclick="changePassword()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Change Password</button>
          <p id="changeError" class="text-red-500 mt-2 hidden"></p>
          <p id="changeSuccess" class="text-green-500 mt-2 hidden">Password changed successfully!</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md mt-6">
          <h3 class="text-xl font-semibold mb-4">Reset Password</h3>
          <div class="mb-4">
            <label for="resetId" class="block text-gray-700 font-semibold">Student ID</label>
            <input type="text" id="resetId" class="w-full p-2 border rounded" placeholder="e.g., KJS001" oninput="showSecurityQuestion()">
          </div>
          <div class="mb-4">
            <label for="resetQuestion" class="block text-gray-700 font-semibold">Security Question</label>
            <input type="text" id="resetQuestion" class="w-full p-2 border rounded" readonly>
          </div>
          <div class="mb-4">
            <label for="resetAnswer" class="block text-gray-700 font-semibold">Security Answer</label>
            <input type="text" id="resetAnswer" class="w-full p-2 border rounded" placeholder="Enter your answer">
          </div>
          <div class="mb-4">
            <label for="resetNewPassword" class="block text-gray-700 font-semibold">New Password (min 6 characters)</label>
            <input type="password" id="resetNewPassword" class="w-full p-2 border rounded" placeholder="Enter new password">
          </div>
          <button onclick="resetPassword()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Reset Password</button>
          <p id="resetError" class="text-red-500 mt-2 hidden"></p>
          <p id="resetSuccess" class="text-green-500 mt-2 hidden">Password reset successfully!</p>
        </div>
      </section>

      <section id="about" class="tab-content hidden">
        <h2 class="text-2xl font-semibold mb-4">Student Leaders – Algocracy System</h2>
        <p class="mb-4">This platform blends student choice with merit using a clear, public formula. Student votes are combined with leadership and performance criteria to select the most suitable leaders.</p>
        <div class="bg-white p-6 rounded-lg shadow-md mb-4">
          <h3 class="text-xl font-semibold mb-2">Criteria & Weights (Total 100%)</h3>
          <p class="mb-2">These weights can be adjusted by Admin (with a PIN). Default model:</p>
          <ul class="list-disc ml-6">
            <li>Student Votes 30%</li>
            <li>Academics 15%</li>
            <li>Discipline 10%</li>
            <li>Clubs 10%</li>
            <li>Community Service 5%</li>
            <li>Teacher 10%</li>
            <li>Leadership 10%</li>
            <li>Public Speaking 10%</li>
          </ul>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold mb-2">How it works</h3>
          <ul class="list-disc ml-6 mb-4">
            <li>Students register with their ID and password, then vote by position.</li>
            <li>Teachers record each student's metric scores (0–100).</li>
            <li>The system computes Final Score per candidate:</li>
          </ul>
          <p class="font-mono text-center mb-4">Final = StudentVotes%×Wsv + Academics%×Wa + Discipline%×Wd + Clubs%×Wc + CommunityService%×Wcs + Teacher%×Wt + Leadership%×Wl + PublicSpeaking%×Wp</p>
          <p>Highest Final Score wins each position. Transparent & reproducible.</p>
        </div>
      </section>

      <section id="vote" class="tab-content hidden">
        <h2 class="text-2xl font-semibold mb-4">Cast Your Vote</h2>
        <div class="bg-white p-6 rounded-lg shadow-md">
          <div class="mb-4">
            <label for="voterId" class="block text-gray-700 font-semibold">Student ID</label>
            <input type="text" id="voterId" class="w-full p-2 border rounded" placeholder="e.g., KJS001" oninput="validateVoter()" required>
          </div>
          <div class="mb-4">
            <label for="voterPassword" class="block text-gray-700 font-semibold">Password</label>
            <input type="password" id="voterPassword" class="w-full p-2 border rounded" placeholder="Enter your password" oninput="validateVoter()" required>
          </div>
          <div class="mb-4">
            <label for="voterName" class="block text-gray-700 font-semibold">Name</label>
            <input type="text" id="voterName" class="w-full p-2 border rounded" readonly>
          </div>
          <div class="mb-4">
            <label for="voterGrade" class="block text-gray-700 font-semibold">Grade</label>
            <input type="text" id="voterGrade" class="w-full p-2 border rounded" readonly>
          </div>
          <div class="mb-4">
            <label for="voterClass" class="block text-gray-700 font-semibold">Class</label>
            <input type="text" id="voterClass" class="w-full p-2 border rounded" readonly>
          </div>
          <div id="votePositions" class="mb-4"></div>
          <button onclick="submitVote()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Submit Vote</button>
          <p id="voteError" class="text-red-500 mt-2 hidden"></p>
          <p class="text-sm text-gray-500 mt-2">Your ID is hashed in-browser. We do not store names or passwords.</p>
        </div>
        <div id="tallyResults" class="mt-6 bg-white p-4 rounded-lg shadow-md hidden">
          <h3 class="text-xl font-semibold mb-2">Live Vote Tally</h3>
          <div id="tallyContainer" class="grid grid-cols-2 gap-4"></div>
        </div>
      </section>

      <section id="results" class="tab-content hidden">
        <h2 class="text-2xl font-semibold mb-4">Computed Results (Student Votes + Criteria)</h2>
        <p class="mb-4">Teachers enter metric scores in the Teacher tab. Student Votes% are calculated automatically from cast votes per position.</p>
        <div id="resultsTable" class="bg-white p-4 rounded-lg shadow-md"></div>
        <button onclick="exportResults()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Export Results (CSV)</button>
      </section>

      <section id="teacher" class="tab-content hidden">
        <h2 class="text-2xl font-semibold mb-4">Teacher Input</h2>
        <div class="bg-white p-6 rounded-lg shadow-md mb-4">
          <p class="mb-4">Enter your username and password to log in.</p>
          <div class="mb-4">
            <label for="teacherUsername" class="block text-gray-700 font-semibold">Username (e.g., teacher7blue)</label>
            <input type="text" id="teacherUsername" class="w-full p-2 border rounded" placeholder="Enter username">
          </div>
          <div class="mb-4">
            <label for="teacherPassword" class="block text-gray-700 font-semibold">Password</label>
            <input type="password" id="teacherPassword" class="w-full p-2 border rounded" placeholder="Enter password">
          </div>
          <button onclick="loginTeacher()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Log In</button>
          <p id="teacherLoginError" class="text-red-500 mt-2 hidden">Invalid username or password.</p>
        </div>
        <div id="teacherForm" class="hidden bg-white p-6 rounded-lg shadow-md">
          <h3 class="text-xl font-semibold mb-2">Enter Metrics for Your Class (0–100)</h3>
          <p class="mb-4">Below are the students in your class. Enter scores for each metric.</p>
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-100">
                <th class="border p-2 text-left">Student</th>
                <th class="border p-2 text-right">Academics</th>
                <th class="border p-2 text-right">Discipline</th>
                <th class="border p-2 text-right">Clubs</th>
                <th class="border p-2 text-right">Community Service</th>
                <th class="border p-2 text-right">Teacher</th>
                <th class="border p-2 text-right">Leadership</th>
                <th class="border p-2 text-right">Public Speaking</th>
              </tr>
            </thead>
            <tbody id="teacherMetricsTable"></tbody>
          </table>
          <button onclick="saveTeacherMetrics()" class="mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Save Metrics</button>
          <p id="teacherSaveStatus" class="text-green-500 mt-2 hidden">Metrics saved successfully!</p>
          <p id="teacherSaveError" class="text-red-500 mt-2 hidden">Please fill all fields with valid scores (0–100).</p>
        </div>
        <div id="teacherChangePassword" class="hidden bg-white p-6 rounded-lg shadow-md mt-6">
          <h3 class="text-xl font-semibold mb-4">Change Password</h3>
          <div class="mb-4">
            <label for="teacherOldPassword" class="block text-gray-700 font-semibold">Old Password</label>
            <input type="password" id="teacherOldPassword" class="w-full p-2 border rounded" placeholder="Enter old password">
          </div>
          <div class="mb-4">
            <label for="teacherNewPassword" class="block text-gray-700 font-semibold">New Password (min 6 characters)</label>
            <input type="password" id="teacherNewPassword" class="w-full p-2 border rounded" placeholder="Enter new password">
          </div>
          <button onclick="changeTeacherPassword()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Change Password</button>
          <p id="teacherChangeError" class="text-red-500 mt-2 hidden"></p>
          <p id="teacherChangeSuccess" class="text-green-500 mt-2 hidden">Password changed successfully!</p>
        </div>
        <div id="teacherResetPassword" class="hidden bg-white p-6 rounded-lg shadow-md mt-6">
          <h3 class="text-xl font-semibold mb-4">Reset Password</h3>
          <div class="mb-4">
            <label for="teacherResetUsername" class="block text-gray-700 font-semibold">Username</label>
            <input type="text" id="teacherResetUsername" class="w-full p-2 border rounded" placeholder="e.g., teacher7blue" oninput="showTeacherSecurityQuestion()">
          </div>
          <div class="mb-4">
            <label for="teacherResetQuestion" class="block text-gray-700 font-semibold">Security Question</label>
            <input type="text" id="teacherResetQuestion" class="w-full p-2 border rounded" readonly>
          </div>
          <div class="mb-4">
            <label for="teacherResetAnswer" class="block text-gray-700 font-semibold">Security Answer</label>
            <input type="text" id="teacherResetAnswer" class="w-full p-2 border rounded" placeholder="Enter your answer">
          </div>
          <div class="mb-4">
            <label for="teacherResetNewPassword" class="block text-gray-700 font-semibold">New Password (min 6 characters)</label>
            <input type="password" id="teacherResetNewPassword" class="w-full p-2 border rounded" placeholder="Enter new password">
          </div>
          <button onclick="resetTeacherPassword()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Reset Password</button>
          <p id="teacherResetError" class="text-red-500 mt-2 hidden"></p>
          <p id="teacherResetSuccess" class="text-green-500 mt-2 hidden">Password reset successfully!</p>
        </div>
        <div id="teacherStudentManagement" class="hidden bg-white p-6 rounded-lg shadow-md mt-6">
          <h3 class="text-xl font-semibold mb-4">Manage Students in Your Class</h3>
          <div class="mb-4">
            <label for="studentIdManage" class="block text-gray-700 font-semibold">Student ID</label>
            <input type="text" id="studentIdManage" class="w-full p-2 border rounded" placeholder="e.g., KJS001">
          </div>
          <div class="mb-4">
            <label for="studentNameManage" class="block text-gray-700 font-semibold">Student Name</label>
            <input type="text" id="studentNameManage" class="w-full p-2 border rounded" placeholder="e.g., sevenblue1">
          </div>
          <div class="flex gap-2 mb-4">
            <button onclick="addStudentToClass()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Student to Class</button>
            <button onclick="removeStudentFromClass()" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Remove Student from Class</button>
          </div>
          <p id="studentManageError" class="text-red-500 mt-2 hidden"></p>
          <p id="studentManageSuccess" class="text-green-500 mt-2 hidden"></p>
          <button onclick="clearAllStudents()" class="w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 mt-4">Clear All Students</button>
        </div>
      </section>

      <section id="admin" class="tab-content hidden">
        <h2 class="text-2xl font-semibold mb-4">Admin Login</h2>
        <div class="bg-white p-6 rounded-lg shadow-md mb-4">
          <p class="mb-4">Default PIN is 1234. Change it below once logged in.</p>
          <div class="mb-4">
            <label for="adminPin" class="block text-gray-700 font-semibold">Enter PIN</label>
            <input type="password" id="adminPin" class="w-full p-2 border rounded" placeholder="Enter PIN">
          </div>
          <button onclick="unlockAdmin()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Unlock Admin</button>
          <button onclick="factoryReset()" class="mt-2 w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Factory Reset (wipe data)</button>
          <p id="adminPinError" class="text-red-500 mt-2 hidden">Invalid PIN.</p>
        </div>
        <div id="adminForm" class="hidden">
          <div class="bg-white p-6 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-semibold mb-2">Voting Control</h3>
            <button onclick="toggleVoting()" id="votingToggleBtn" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"></button>
            <p id="votingStatus" class="text-gray-500 mt-2"></p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-semibold mb-2">Positions & Candidates</h3>
            <div class="mb-4">
              <label for="newPosition" class="block text-gray-700 font-semibold">New Position</label>
              <input type="text" id="newPosition" class="w-full p-2 border rounded" placeholder="e.g., School President">
              <button onclick="addPosition()" class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Position</button>
            </div>
            <div class="mb-4">
              <h4 class="text-lg font-semibold mb-2">Manage Candidates</h4>
              <div class="flex flex-col gap-2">
                <label for="candidatePosition" class="block text-gray-700 font-semibold">Select Position</label>
                <select id="candidatePosition" class="w-full p-2 border rounded" onchange="updateCandidateList()">
                  <option value="">Select a position</option>
                </select>
                <label for="candidateId" class="block text-gray-700 font-semibold">Student ID (KJS001–KJS057)</label>
                <input type="text" id="candidateId" class="w-full p-2 border rounded" placeholder="e.g., KJS001">
                <div class="flex gap-2">
                  <button onclick="addCandidate()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Candidate</button>
                  <button onclick="removeCandidate()" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Remove Candidate</button>
                </div>
                <p id="candidateError" class="text-red-500 mt-2 hidden"></p>
                <p id="candidateSuccess" class="text-green-500 mt-2 hidden"></p>
              </div>
              <div id="candidateList" class="mt-4"></div>
            </div>
            <div id="positionList"></div>
            <button onclick="clearAllCandidates()" class="mt-4 w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Clear All Candidates</button>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-semibold mb-2">Manage Teachers</h3>
            <div class="mb-4">
              <label for="newTeacher" class="block text-gray-700 font-semibold">Add Teacher (Username, Grade, Class, Password)</label>
              <input type="text" id="newTeacher" class="w-full p-2 border rounded" placeholder="e.g., teacher7blue,7,Blue,1234">
              <button onclick="addTeacher()" class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Teacher</button>
            </div>
            <div id="teacherList"></div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-semibold mb-2">Weights (0–100 total)</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label for="weightStudentVotes" class="block text-gray-700">Student Votes (%)</label>
                <input type="number" id="weightStudentVotes" min="0" max="100" class="w-full p-2 border rounded" value="30" required>
              </div>
              <div>
                <label for="weightAcademics" class="block text-gray-700">Academics (%)</label>
                <input type="number" id="weightAcademics" min="0" max="100" class="w-full p-2 border rounded" value="15" required>
              </div>
              <div>
                <label for="weightDiscipline" class="block text-gray-700">Discipline (%)</label>
                <input type="number" id="weightDiscipline" min="0" max="100" class="w-full p-2 border rounded" value="10" required>
              </div>
              <div>
                <label for="weightClubs" class="block text-gray-700">Clubs (%)</label>
                <input type="number" id="weightClubs" min="0" max="100" class="w-full p-2 border rounded" value="10" required>
              </div>
              <div>
                <label for="weightCommunityService" class="block text-gray-700">Community Service (%)</label>
                <input type="number" id="weightCommunityService" min="0" max="100" class="w-full p-2 border rounded" value="5" required>
              </div>
              <div>
                <label for="weightTeacher" class="block text-gray-700">Teacher (%)</label>
                <input type="number" id="weightTeacher" min="0" max="100" class="w-full p-2 border rounded" value="10" required>
              </div>
              <div>
                <label for="weightLeadership" class="block text-gray-700">Leadership (%)</label>
                <input type="number" id="weightLeadership" min="0" max="100" class="w-full p-2 border rounded" value="10" required>
              </div>
              <div>
                <label for="weightPublicSpeaking" class="block text-gray-700">Public Speaking (%)</label>
                <input type="number" id="weightPublicSpeaking" min="0" max="100" class="w-full p-2 border rounded" value="10" required>
              </div>
            </div>
            <button onclick="saveWeights()" class="mt-4 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Save Weights</button>
            <p id="weightsError" class="text-red-500 mt-2 hidden">Weights must total 100%.</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-semibold mb-2">Security & Data</h3>
            <div class="mb-4">
              <label for="newPin" class="block text-gray-700 font-semibold">Change PIN</label>
              <input type="password" id="newPin" class="w-full p-2 border rounded" placeholder="Enter new PIN">
              <button onclick="updatePin()" class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Update PIN</button>
            </div>
            <button onclick="exportVotes()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Export Votes (CSV)</button>
            <button onclick="downloadBackup()" class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Download Backup (JSON)</button>
            <div class="mt-2">
              <label for="importBackup" class="block text-gray-700 font-semibold">Import Backup</label>
              <input type="file" id="importBackup" accept=".json" class="w-full p-2 border rounded">
              <button onclick="importBackup()" class="mt-2 w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Import Backup</button>
            </div>
            <p class="text-sm text-gray-500 mt-2">Tip: To connect this page to Google Sheets, publish a Google Apps Script as a Web App and change VOTE_ENDPOINT in the source. The page will still work offline via localStorage.</p>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-6 text-center text-gray-500">
      <p>Built for transparency & learning by KISC JUNIOR SCHOOL STEM CLUB</p>
    </footer>
  </div>
  <script src="main.js"></script>
</body>
</html>
